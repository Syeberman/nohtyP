version: 0.5.{build}

branches:
  only:
    - main

skip_branch_with_pr: true

image:
  - Visual Studio 2019
  - Ubuntu2004
  - Visual Studio 2017
  - Ubuntu1604
  - Visual Studio 2015

cache: Build/site_toolsconfig.py

build_script:
  - pwsh: >-
      if ($isWindows) {$env:Path = "C:/Python38-x64;" + $env:Path}
      if ($isLinux) {. $HOME/venv3.8/bin/activate.ps1}
      Build/make all
      if (! $?) {throw "build failed"}

test_script:
  - pwsh: >-
      if ($isWindows) {$env:Path = "C:/Python38-x64;" + $env:Path}
      if ($isLinux) {. $HOME/venv3.8/bin/activate.ps1}
      Build/make testall
      if (! $?) {
        7z a yp_test.log.zip Build/*/*/yp_test.log
        appveyor PushArtifact yp_test.log.zip
        throw "build failed"
      }

deploy: off
